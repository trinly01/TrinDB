!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.TrinDB=e():t.TrinDB=e()}(global,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e){t.exports=require("crypto")},function(t,e){t.exports=require("stream")},function(t,e,r){var n=r(1);function i(t,e,r){t=t||function(t){this.queue(t)},e=e||function(){this.queue(null)};var i=!1,o=!1,a=[],u=!1,c=new n;function s(){for(;a.length&&!c.paused;){var t=a.shift();if(null===t)return c.emit("end");c.emit("data",t)}}function f(){c.writable=!1,e.call(c),!c.readable&&c.autoDestroy&&c.destroy()}return c.readable=c.writable=!0,c.paused=!1,c.autoDestroy=!(r&&!1===r.autoDestroy),c.write=function(e){return t.call(this,e),!c.paused},c.queue=c.push=function(t){return u||(null===t&&(u=!0),a.push(t),s()),c},c.on("end",(function(){c.readable=!1,!c.writable&&c.autoDestroy&&process.nextTick((function(){c.destroy()}))})),c.end=function(t){if(!i)return i=!0,arguments.length&&c.write(t),f(),c},c.destroy=function(){if(!o)return o=!0,i=!0,a.length=0,c.writable=c.readable=!1,c.emit("close"),c},c.pause=function(){if(!c.paused)return c.paused=!0,c},c.resume=function(){return c.paused&&(c.paused=!1,c.emit("resume")),s(),c.paused||c.emit("drain"),c},c}t.exports=i,i.through=i},function(t,e,r){var n=r(1),i=["write","end","destroy"],o=["resume","pause"],a=["data","close"],u=Array.prototype.slice;function c(t,e){if(t.forEach)return t.forEach(e);for(var r=0;r<t.length;r++)e(t[r],r)}t.exports=function(t,e){var r=new n,s=!1;return c(i,(function(e){r[e]=function(){return t[e].apply(t,arguments)}})),c(o,(function(t){r[t]=function(){r.emit(t);var n=e[t];if(n)return n.apply(e,arguments);e.emit(t)}})),c(a,(function(t){e.on(t,(function(){var e=u.call(arguments);e.unshift(t),r.emit.apply(r,e)}))})),e.on("end",(function(){if(s)return;s=!0;var t=u.call(arguments);t.unshift("end"),r.emit.apply(r,t)})),t.on("drain",(function(){r.emit("drain")})),t.on("error",f),e.on("error",f),r.writable=t.writable,r.readable=e.readable,r;function f(t){r.emit("error",t)}}},function(t,e,r){"use strict";r.r(e),r.d(e,"v1",(function(){return p})),r.d(e,"v3",(function(){return h})),r.d(e,"v4",(function(){return m})),r.d(e,"v5",(function(){return v}));var n=r(0),i=r.n(n);function o(){return i.a.randomBytes(16)}for(var a=[],u=0;u<256;++u)a[u]=(u+256).toString(16).substr(1);var c,s,f=function(t,e){var r=e||0,n=a;return[n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],"-",n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]],n[t[r++]]].join("")},d=0,l=0;var p=function(t,e,r){var n=e&&r||0,i=e||[],a=(t=t||{}).node||c,u=void 0!==t.clockseq?t.clockseq:s;if(null==a||null==u){var p=t.random||(t.rng||o)();null==a&&(a=c=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==u&&(u=s=16383&(p[6]<<8|p[7]))}var y=void 0!==t.msecs?t.msecs:(new Date).getTime(),h=void 0!==t.nsecs?t.nsecs:l+1,m=y-d+(h-l)/1e4;if(m<0&&void 0===t.clockseq&&(u=u+1&16383),(m<0||y>d)&&void 0===t.nsecs&&(h=0),h>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=y,l=h,s=u;var v=(1e4*(268435455&(y+=122192928e5))+h)%4294967296;i[n++]=v>>>24&255,i[n++]=v>>>16&255,i[n++]=v>>>8&255,i[n++]=255&v;var b=y/4294967296*1e4&268435455;i[n++]=b>>>8&255,i[n++]=255&b,i[n++]=b>>>24&15|16,i[n++]=b>>>16&255,i[n++]=u>>>8|128,i[n++]=255&u;for(var g=0;g<6;++g)i[n+g]=a[g];return e||f(i)};var y=function(t,e,r){var n=function(t,n,i,o){var a=i&&o||0;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}(t)),"string"==typeof n&&(n=function(t){var e=[];return t.replace(/[a-fA-F0-9]{2}/g,(function(t){e.push(parseInt(t,16))})),e}(n)),!Array.isArray(t))throw TypeError("value must be an array of bytes");if(!Array.isArray(n)||16!==n.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var u=r(n.concat(t));if(u[6]=15&u[6]|e,u[8]=63&u[8]|128,i)for(var c=0;c<16;++c)i[a+c]=u[c];return i||f(u)};try{n.name=t}catch(t){}return n.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",n.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",n};var h=y("v3",48,(function(t){return Array.isArray(t)?t=Buffer.from(t):"string"==typeof t&&(t=Buffer.from(t,"utf8")),i.a.createHash("md5").update(t).digest()}));var m=function(t,e,r){var n=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var i=(t=t||{}).random||(t.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,e)for(var a=0;a<16;++a)e[n+a]=i[a];return e||f(i)};var v=y("v5",80,(function(t){return Array.isArray(t)?t=Buffer.from(t):"string"==typeof t&&(t=Buffer.from(t,"utf8")),i.a.createHash("sha1").update(t).digest()}))},function(t,e,r){const n=r(6);t.exports=async t=>await new Promise((e,r)=>{try{n(t,t=>{e(t)})}catch(t){r(t)}})},function(t,e,r){const n=r(7),i=r(15),o=r(16),{v4:a}=r(4),u=a;let c=new Function("try {return this===window;}catch(e){ return false;}");const s=c()?{}:r(19),f=c()?{}:r(20);t.exports=({filename:t="test.db",inMemoryOnly:e=!1},r)=>{const a={};let c=0;if(e)return void r(o({total:c,data:a},{mrDot:i,inMemoryOnly:e}));const d=f.resolve(process.cwd()+"/"+t),l=o({total:c,data:a},{fs:s,path:d,mrDot:i,inMemoryOnly:e});if(!s.existsSync(d)){const t=d.split(/(\\|\/)/);t.pop();const e=t.join("/");s.mkdirSync(e),s.writeFileSync(d,"")}s.createReadStream(d).pipe(n.split()).pipe(n.mapSync(t=>{if(""!==t){const e=JSON.parse(t);switch(e.action||(e._id=e._id||u(),e={action:"create",data:e}),e.action){case"create":c+=1,a[e.data._id]=e.data;break;case"patch":for(const t in e.data)i(a[e.data._id],t,e.data[t]);break;case"remove":c-=1,delete a[e.data._id];break;case"deleteProps":for(const t in e.data)if("_id"!==t){const r=t.split("."),n=r.pop();delete i(a[e.data._id],r)[n]}break;case"inc":for(const t in e.data)if("_id"!==t){const r=i(a[e.data._id],t)+e.data[t];i(a[e.data._id],t,r)}break;case"splice":for(const t in e.data)"_id"!==t&&i(a[e.data._id],t).splice(e.data[t],1);break;case"concat":for(const t in e.data)if("_id"!==t){let r=i(a[e.data._id],t);r.push.apply(r,e.data[t])}break;default:for(const t in e.data)"_id"!==t&&i(a[e.data._id],t)[e.action](e.data[t])}}}).on("end",()=>{r(l),l.compact()}))}},function(t,e,r){var n=r(1).Stream,i=e,o=r(2),a=r(8),u=r(3),c=r(9),s=r(10),f=r(11),d=r(13),l=global.setImmediate||process.nextTick;i.Stream=n,i.through=o,i.from=a,i.duplex=u,i.map=c,i.pause=s,i.split=f,i.pipeline=i.connect=i.pipe=d,i.concat=i.merge=function(){var t=[].slice.call(arguments);1===t.length&&t[0]instanceof Array&&(t=t[0]);var e=new n;e.setMaxListeners(0);var r=0;return e.writable=e.readable=!0,t.length?t.forEach((function(n){n.pipe(e,{end:!1});var i=!1;n.on("end",(function(){i||(i=!0,++r==t.length&&e.emit("end"))}))})):process.nextTick((function(){e.emit("end")})),e.write=function(t){this.emit("data",t)},e.destroy=function(){t.forEach((function(t){t.destroy&&t.destroy()}))},e},i.collect=i.writeArray=function(t){if("function"!=typeof t)throw new Error("function writeArray (done): done must be function");var e=new n,r=[],i=!1;return e.write=function(t){r.push(t)},e.end=function(){i=!0,t(null,r)},e.writable=!0,e.readable=!1,e.destroy=function(){e.writable=e.readable=!1,i||t(new Error("destroyed before end"),r)},e},i.readArray=function(t){var e=new n,r=0,i=!1,o=!1;if(e.readable=!0,e.writable=!1,!Array.isArray(t))throw new Error("event-stream.read expects an array");return e.resume=function(){if(!o){i=!1;for(var n=t.length;r<n&&!i&&!o;)e.emit("data",t[r++]);r!=n||o||(o=!0,e.readable=!1,e.emit("end"))}},process.nextTick(e.resume),e.pause=function(){i=!0},e.destroy=function(){o=!0,e.emit("close")},e},i.readable=function(t,e){var r=new n,i=0,o=!1,a=!1,u=!1;if(r.readable=!0,r.writable=!1,"function"!=typeof t)throw new Error("event-stream.readable expects async function");function c(n,s){n?(r.emit("error",n),e||r.emit("end")):arguments.length>1&&r.emit("data",s),l((function(){if(!(a||o||u))try{u=!0,t.call(r,i++,(function(){u=!1,c.apply(null,arguments)}))}catch(t){r.emit("error",t)}}))}return r.on("end",(function(){a=!0})),r.resume=function(){o=!1,c()},process.nextTick(c),r.pause=function(){o=!0},r.destroy=function(){r.emit("end"),r.emit("close"),a=!0},r},i.mapSync=function(t){return i.through((function(e){var r;try{r=t(e)}catch(t){return this.emit("error",t)}void 0!==r&&this.emit("data",r)}))},i.filterSync=function(t){return i.through((function(e){t(e)&&this.queue(e)}))},i.flatmapSync=function(t){return i.through((function(e){var r=this;e.forEach((function(e){r.queue(t(e))}))}))},i.log=function(t){return i.through((function(e){[].slice.call(arguments);t?console.error(t,e):console.error(e),this.emit("data",e)}))},i.child=function(t){return i.duplex(t.stdin,t.stdout)},i.parse=function(t){var e=!(!t||!t.error);return i.through((function(t){var r;try{t&&(r=JSON.parse(t.toString()))}catch(r){return e?this.emit("error",r):console.error(r,"attempting to parse:",t)}void 0!==r&&this.emit("data",r)}))},i.stringify=function(){var t=r(14).Buffer;return i.mapSync((function(e){return JSON.stringify(t.isBuffer(e)?e.toString():e)+"\n"}))},i.replace=function(t,e){return i.pipeline(i.split(t),i.join(e))},i.join=function(t){if("function"==typeof t)return i.wait(t);var e=!0;return i.through((function(r){return e||this.emit("data",t),e=!1,this.emit("data",r),!0}))},i.wait=function(t){var e=[];return i.through((function(t){e.push(t)}),(function(){var r=Buffer.isBuffer(e[0])?Buffer.concat(e):e.join("");this.emit("data",r),this.emit("end"),t&&t(null,r)}))},i.pipeable=function(){throw new Error("[EVENT-STREAM] es.pipeable is deprecated")}},function(t,e,r){"use strict";var n=r(1);t.exports=function t(e){if(Array.isArray(e)){var r=0,i=e.length;return t((function(t){return r<i?this.emit("data",e[r++]):this.emit("end"),!0}))}var o=new n,a=0;function u(){if(o.started=!0,!o.ended)for(;!o.ended&&!o.paused&&e.call(o,a++,(function(){o.ended||o.paused||process.nextTick(u)})););}return o.ended=!1,o.started=!1,o.readable=!0,o.writable=!1,o.paused=!1,o.ended=!1,o.pause=function(){o.started=!0,o.paused=!0},o.resume=function(){o.started=!0,o.paused=!1,u()},o.on("end",(function(){o.ended=!0,o.readable=!1,process.nextTick(o.destroy)})),o.destroy=function(){o.ended=!0,o.emit("close")},process.nextTick((function(){o.started||o.resume()})),o}},function(t,e,r){var n=r(1).Stream;t.exports=function(t,e){var r=new n,i=0,o=0,a=!1,u=!1,c=!1,s=0,f=!1,d=(e=e||{}).failures?"failure":"error",l={};function p(t,e){var n=s+1;if(e===n?(void 0!==t&&r.emit.apply(r,["data",t]),s++,n++):l[e]=t,l.hasOwnProperty(n)){var c=l[n];return delete l[n],p(c,n)}o++,i===o&&(u&&(u=!1,r.emit("drain")),a&&h())}function y(t,n,i){c||(f=!0,t&&!e.failures||p(n,i),t&&r.emit.apply(r,[d,t]),f=!1)}function h(t){if(a=!0,r.writable=!1,void 0!==t)return p(t,i);i==o&&(r.readable=!1,r.emit("end"),r.destroy())}return r.writable=!0,r.readable=!0,r.write=function(e){if(a)throw new Error("map stream is not writable");f=!1,i++;try{var r=(n=e,o=i,c=y,t.call(null,n,(function(t,e){c(t,e,o)})));return!(u=!1===r)}catch(t){if(f)throw t;return y(t),!u}var n,o,c},r.end=function(t){a||h(t)},r.destroy=function(){a=c=!0,r.writable=r.readable=u=!1,process.nextTick((function(){r.emit("close")}))},r.pause=function(){u=!0},r.resume=function(){u=!1},r}},function(t,e,r){t.exports=r(2)},function(t,e,r){var n=r(2),i=r(12).StringDecoder;t.exports=function(t,e,r){var o=new i,a="",u=r&&r.maxLength,c=!r||!1!==r.trailing;"function"==typeof t&&(e=t,t=null);t||(t=/\r?\n/);function s(t,r){if(e){try{r=e(r)}catch(e){return t.emit("error",e)}void 0!==r&&t.queue(r)}else t.queue(r)}function f(e,r){var n=((null!=a?a:"")+r).split(t);if(a=n.pop(),u&&a.length>u)return e.emit("error",new Error("maximum buffer reached"));for(var i=0;i<n.length;i++){s(e,n[i])}}return n((function(t){f(this,o.write(t))}),(function(){o.end&&f(this,o.end()),c&&null!=a&&s(this,a),this.queue(null)}))}},function(t,e){t.exports=require("string_decoder")},function(t,e,r){var n=r(3),i=r(2);t.exports=function(){var t;if(0==(t=1==arguments.length&&Array.isArray(arguments[0])?arguments[0]:[].slice.call(arguments)).length)return i();if(1==t.length)return t[0];var e=t[0],r=t[t.length-1],o=n(e,r);function a(t){t.length<2||(t[0].pipe(t[1]),a(t.slice(1)))}function u(){var t=[].slice.call(arguments);t.unshift("error"),o.emit.apply(o,t)}a(t);for(var c=1;c<t.length-1;c++)t[c].on("error",u);return o}},function(t,e){t.exports=require("buffer")},function(t,e){t.exports=function t(e,r,n){try{return"string"==typeof r?t(e,r.split("."),n):1==r.length&&void 0!==n?e[r[0]]=n:0==r.length?e:t(e[r[0]],r.slice(1),n)}catch(t){return}}},function(t,e,r){const{v4:n}=r(4),i=n,o=r(17),a=r(18);t.exports=(t,{fs:e,path:r,mrDot:n,inMemoryOnly:u})=>{const c=(t,r,n)=>{const i={action:r,data:n};if(!u){const r=JSON.stringify(i);e.appendFile(t,`${r}\r\n`,t=>{if(t)throw t})}return i};return{create:e=>(t.total=t.total+1,e._id=e._id||i(),t.data[e._id]=e,c(r,"create",e)),patch(e,i){for(const r in i)n(t.data[e],r,i[r]);return i._id=e,c(r,"patch",i)},remove:e=>(t.total=t.total-1,delete t.data[e],c(r,"remove",{_id:e})),deleteProps(e,i){i._id=e;for(const r in i)if("_id"!==r&&!0===i[r]){const i=r.split("."),o=i.pop();delete n(t.data[e],i)[o]}return c(r,"deleteProps",i)},inc(e,i){i._id=e;for(const r in i)if("_id"!==r){const o=+n(t.data[e],r)+ +i[r];n(t.data[e],r,o)}return c(r,"inc",i)},splice(e,i){i._id=e;for(const r in i)"_id"!==r&&n(t.data[e],r).splice(i[r],1);JSON.stringify({action:"splice",data:i});return c(r,"splice",i)},concat(e,i){i._id=e;for(const r in i)if("_id"!==r){let o=n(t.data[e],r);o.push.apply(o,i[r])}return c(r,"concat",i)},arrayFunction(e,i,o){o._id=i;for(const r in o)"_id"!==r&&n(t.data[i],r)[e](o[r]);return c(r,e,o)},push(t,e){return this.arrayFunction("push",t,e)},unshift(t,e){return this.arrayFunction("unshift",t,e)},compact:(n=r,i=t.data)=>(o(n,i,e),n),search(e){const r={};let n=0;for(const i in t.data){const o=t.data[i],u=a(e,o);u._score&&(n+=1,r[i]=u)}return{total:n,data:this.sort({data:r,params:{_score:-1}})}},sort({data:e=t.data,params:r}){const i={},o=Object.keys(e);o.sort((t,i)=>{if("function"==typeof r)return r(e[t],e[i]);for(const o in r){let a=n(e[t],o),u=n(e[i],o);if("string"==typeof a&&"string"==typeof u&&(a=a.toLowerCase(),u=u.toLowerCase()),-1===r[o]){if(a>u)return-1;if(a<u)return 1}else{if(a>u)return 1;if(a<u)return-1}}});for(const t of o)i[t]=e[t];return i},paginate({data:e=t.data,total:r,limit:n=10,skip:i=0}){n=+n,i=+i;const o=Object.keys(e);r=r||o.length;const a={},u=n+i;for(let t=i;t<u;t++){const r=o[t];if(!r)break;a[r]=e[r]}return{total:r,limit:n,skip:i,data:a}},find({query:e={},map:r,...i}){const o=e,a={};let u=0;r||(r=t=>t);for(const e in t.data){const i=t.data[e];if("function"==typeof o)o(i)&&(u+=1,a[e]=r(i));else{let t=0,c=0;for(const e in o)t+=1,n(i,e)===o[e]&&(c+=1);c===t&&(u+=1,a[e]=r(i))}}return this.paginate({total:u,data:a,...i})}}}},function(t,e){t.exports=(t,e,r)=>{r.writeFileSync(t,"");for(const n in e){const i=JSON.stringify({action:"create",data:e[n]});r.appendFileSync(t,`${i}\r\n`)}}},function(t,e){let r=(t,e)=>"string"==typeof t||"number"==typeof t?e(t.toString().toLowerCase()):null!==t&&"object"==typeof t?Object.values(t).some(t=>r(t,e)):Array.isArray(t)?t.some(t=>r(t,e)):void 0;t.exports=(t="",e)=>{let n="",i=0,o=t.toLowerCase().replace(/\s\s+/g," ").trim().split(" ");return r(e,t=>{if(n=n+" "+t,i=((t,e)=>{let r=0;for(const n of t)e.indexOf(n)>-1&&(r+=1);return r})(o,n),i===o.length)return i}),{_score:i,...e}}},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")}])}));